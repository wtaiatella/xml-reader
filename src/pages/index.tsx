import Head from 'next/head';
import 'antd/dist/reset.css';
import { XmlTable } from '../components/XmlTable';
import { Header } from '../components/Header';
import { useContext, useEffect } from 'react';
import { UserContext } from '../contexts/UserContext';

import xmlService from '../services/xmlService';

export const getServerSideProps = async () => {
	const xmlConfig = await xmlService.findXmlConfig();

	return {
		props: {
			xmlConfig, // props for the Home component
		},
	};
};

interface IXmlConfig {
	key: string;
	Width: number;
	Height: number;
	newSizeX: number;
	newSizeY: number;
	limitLeft: number;
	limitRight: number;
	hasRightMenu: boolean;
}
export default function Home({ xmlConfig }: { xmlConfig: IXmlConfig }) {
	const { xmlData, setXmlData } = useContext(UserContext);

	useEffect(() => {
		if (xmlConfig) {
			setXmlData({
				...xmlData,
				xmlConfig,
			});
		}
		// eslint-disable-next-line react-hooks/exhaustive-deps
	}, [xmlConfig]);

	return (
		<>
			<Head>
				<title>XML Editor</title>
				<meta
					name='description'
					content='Generated by Wagner Elias Taiatella'
				/>
				<meta
					name='viewport'
					content='width=device-width, initial-scale=1'
				/>
				<link rel='icon' href='/favicon.png' />
			</Head>
			<main>
				<Header />
				<XmlTable />
			</main>
		</>
	);
}
